---

- name: Install Nessus Agent from repo
  package: name={{nessus_agent_package}}
  when: "'.deb' not in nessus_agent_package"

- name: Install Nessus Agent from .deb package
  apt: deb={{nessus_agent_package}}
  when: "'.deb' in nessus_agent_package"

- name: Create Nessus linking service
  template: src=nessus_link.service dest=/etc/systemd/system/nessus_link.service
  notify:
    - restart nessusagent
    - restart nessus_link

- name: Ensure nessus_link is started
  service: name=nessus_link state=started enabled=yes

- name: Ensure nessusagent is started
  service: name=nessusagent state=started enabled=yes

- name: Check agent link status
  command: "{{ nessus_cli_path }} agent status"
  become: yes
